.wrapper {
  margin: 0 auto;
  @if $site_wrapper_width {
    max-width: $site_wrapper_width + px;
  }
  min-width: 320px;
  width: 100%;
}

body {
  background-color: $site_color_background;
}

/**
 * Topline
 */
.site-topline-wrapper {
  @extend .clearfix;
  background-color: $topline_color_background;
  @if $topline_color_background_opacity < 100 {
    background-color: rgba($topline_color_background, ( $topline_color_background_opacity / 100 ) );
  }
  border-bottom: 1px solid mix($topline_color_background, $topline_color_foreground, 90%);
  color: $topline_color_foreground;
  @extend .small;
  padding: .2em 0;
  text-align: left;
}

/**
 * Header
 */
.site-header-wrapper {
  @extend .clearfix;

  position: relative;
  left: 0;
  right: 0;
  top: 0;
  z-index: 100;

  // Sticky header tweaks.
  @media (min-width: $breakpoint_tablet+1) {
    body.sticky-header & {
      position: sticky;
    }
    body.sticky-header.admin-bar & {
      top: 32px;
    }
  }

  // @TODO optimize this
  @if $header_background_wrapper {
    background-color: $header_color_background;
    @if $header_color_background_opacity < 100 {
      background-color: rgba($header_color_background, ($header_color_background_opacity / 100));
    }
    color: $header_color_foreground;
    @if (abs(lightness($header_color_background) - lightness($main_color_background) ) < 5) {
      border-bottom: 1px solid mix($header_color_background, $header_color_foreground, 90%);
    }
  }
  @else {
    .site-header {
      padding: 1em;
      background-color: $header_color_background;
      @if $header_color_background_opacity < 100 {
        background-color: rgba($header_color_background, ($header_color_background_opacity / 100));
      }
      color: $header_color_foreground;
      @if (abs(lightness($header_color_background) - lightness($main_color_background) ) < 5) {
        border-bottom: 1px solid mix($header_color_background, $header_color_foreground, 90%);
      }
    }
  }

  a, textarea, select, input {
    color: $header_color_foreground;
  }
  a:hover {
    color: $color_secondary;
    text-decoration: none;
  }

  .site-header {
    @extend .wrapper;
    -js-display: flex;
    display: flex;
    flex-flow: row wrap;
    @if $header_padding {
      padding-top: $header_padding + px;
      padding-bottom: $header_padding + px;
    }
    justify-content: space-between;
    align-items: center;

    .widget {
      display: inline-block;
      max-width: 50%;
      margin: 0 1em; // Make vertical spacing as small as possible to allow user almost eleminate spacing.
      &:only-child {
        margin-left: auto;
        margin-right: auto;
      }
    }

    @media (min-width: $breakpoint_tablet) {
      .widget:first-child {
        margin-left: 0;
      }
      .widget:last-child {
        margin-right: 0;
      }
      .widget_search {
        max-width: 200px;
      }
    }

    @media (max-width: $breakpoint_tablet) {
      flex-flow: column;
      // Reset user defined (from Customizer) padding from top and bottom.
      padding-top: 0;
      padding-bottom: 0;
      .widget {
        margin: 1em;
        max-width: 100%;
      }
    }

    // Logo widget tweaks
    .widget_tinsta-logo {
      color: lighten($header_color_foreground, 10%);
    }

    // All nav menus in header.
    .widget_nav_menu {
      .menu {
        @extend .menu-inline;
        @media (min-width: $breakpoint_tablet) {
          > li {
            position: relative;
            > a {
              height: 100%;
              letter-spacing: 1px;
              padding: 0 1em;
              &:hover {
                background-color: transparent;
              }
            }
            > .sub-menu {
              left: 50%;
              transform: translateX(-50%);
              &:before {
                left: 50% !important;
                margin-left: -5px;
              }
            }
          }
        }
      }
    }

  }

  /**
   * Main menu.
   */
  .site-primary-menu {

    @if $header_background_wrapper {
      background-color: $primary_menu_color_background;
      @if $primary_menu_color_background_opacity < 100 {
        background-color: rgba($primary_menu_color_background, ($primary_menu_color_background_opacity / 100));
        body.effects & {
          backdrop-filter: saturate(180%) blur(4px);
        }
      }
    }
    @else {
      .menu {
        background-color: $primary_menu_color_background;
        @if $primary_menu_color_background_opacity < 100 {
          background-color: rgba($primary_menu_color_background, ($primary_menu_color_background_opacity / 100));
          body.effects & {
            backdrop-filter: saturate(180%) blur(4px);
          }
        }
      }
    }

    position: relative;
    @extend .clearfix;
    .menu {
      @extend .wrapper;
      @extend .menu-inline;


      > li {
        > .sub-menu {
          &:before {
            display: none;
          }
          border-top: none !important;
        }
      }
      > li:hover > a,
      > li > a:hover,
      > .current-menu-ancestor > a,
      > li.current-menu-item > a {
        background-color: $primary_menu_color_background;
        color: mix($primary_menu_color_background, $primary_menu_color_foreground, 20%);
      }
    }

    // @TODO use $primary_menu_color_foreground and background for sub-menu items and active states.
  }
}


/**
 * The main container area
 */
.site-container-wrapper {

  color: $main_color_foreground;
  background-color: $main_color_background;
  @if $main_color_background_opacity < 100 {
    background-color: rgba($main_color_background, ( $main_color_background_opacity / 100 ) );
  }

  .site-container {

    @extend .wrapper;

    vertical-align: top;
    table-layout: fixed;
    display: table;

    // @TODO replace table with flex and re-arrange the sidebars like [main], [primary sidebar], [secondary sidebar] then re-arrange with flex order.
    // right now, there is some issue with .site-main{} it goes over-sized.
    //flex-flow: row wrap;
    //justify-content: space-between;
    //display: flex;
    //.sidebar {
    //  flex-grow: 0;
    //  flex-shrink: 0;
    //}

    .site-main {
      display: table-cell;
      vertical-align: top;
      width: auto;
    }

    body.page-template-template-thin & {
      display: block;
      width: 50%;
    }

    body.page-template-template-thick & {
      display: block;
      width: 100%;
      max-width: 100%;
    }

    .sidebar {
      display: table-cell;
      vertical-align: top;
      padding-right: 2em;
      padding-top: 2em;
      @if $sidebar_primary_width {
        width: $sidebar_primary_width + px;
      }
      @if $sidebar_primary_color_background {
        background-color: $sidebar_primary_color_background;
        color: $sidebar_primary_color_foreground;
      }

      &.sidebar-secondary {
        @if $sidebar_secondary_width {
          width: $sidebar_secondary_width + px;
        }
        padding-left: 2em;
        padding-right: 0;
        @if $sidebar_secondary_color_background {
          background-color: $sidebar_secondary_color_background;
          color: $sidebar_secondary_color_foreground;
        }
      }

      .sidebar-title {
        @extend .base-title;
        @extend .bigger;
        margin-bottom: .6em;
        margin-top: .6em;
      }

    }

    @media (max-width: $breakpoint_tablet) {
      width: 96%;
      margin-left: 2%;
      margin-right: 2%;
      .site-main {
        display: table-header-group;
        &:not(:last-child) {
          border-bottom: 1px solid mix($main_color_background, $main_color_foreground, 90%);
        }
      }
      .sidebar,
      .sidebar.sidebar-secondary {
        display: table-row-group;
      }
    }

  }
}


/**
 * Footer
 */
.site-footer-wrapper {
  @extend .clearfix;

  background-color: $footer_color_background;
  @if $footer_color_background_opacity < 100 {
    background-color: rgba($footer_color_background, ( $footer_color_background_opacity / 100 ) );
  }

  body.effects:not(.boxed) & {
    box-shadow: inset 0 9px 8px -8px rgba(0, 0, 0, .5);
  }
  .site-footer {
    @extend .wrapper;
    border-collapse: collapse;
    border-spacing: 1em;
    -js-display: flex;
    display: flex;
    flex-flow: row wrap;
    justify-content: space-between;
    margin-bottom: 1em;
    text-align: center;


    @if $footer_background_highlight_inner {
      background: rgba( $footer_color_foreground , .1);
    }

    @media (max-width: $breakpoint_tablet) and (min-width: $breakpoint_mobile) {
      flex-flow: column;
    }

    .widget {
      display: inline-block;
      max-width: 30%;
      margin: 1em;
      text-align: left;
      vertical-align: top;
      width: auto;

      &:only-child {
        margin-left: auto;
        margin-right: auto;
      }

      @media (max-width: $breakpoint_tablet) and (min-width: $breakpoint_mobile) {
        min-width: 39%;
        max-width: 59%;
      }

      @media (max-width: $breakpoint_mobile) {
        display: block;
        width: 100%;
        max-width: calc( 100% - 2em );
      }

    }

  }
  &, input, textarea, select, a, .widgettitle, button {
    color: $footer_color_foreground
  }
  a:hover {
    color: $color_secondary;
    text-decoration: none;
  }
  input, textarea, select {
    background-color: darken($footer_color_background, 7%);
    border-color: darken($footer_color_background, 10%);
    body.effects {
      box-shadow: inset 0 2px 3px rgba(0, 0, 0, .1);
    }
    color: $footer_color_foreground;
    &:focus {
      background-color: darken($footer_color_background, 4%);
    }
  }
  input[type=button], input[type=submit], input[type=reset], button, .button {
    background-color: darken($footer_color_background, 7%);
    border-color: darken($footer_color_background, 7%);
    box-shadow: none;
    color: $footer_color_foreground;
    &:hover {
      background-color: darken($footer_color_background, 5%);
      border-color: darken($footer_color_background, 5%);
    }
  }
  .widget .widgettitle {
    border-bottom: 1px solid mix($footer_color_foreground, $footer_color_background, 10%);
    margin: 0 0 .8em 0;
    padding: .8em 0;
    text-align: center;
    font-weight: bold;
  }
}


/**
 * Bottom
 */
.site-bottomline-wrapper {
  @extend .clearfix;
  @if $bottomline_sticky {
    position: sticky;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 100;
  }
  background-color: $bottomline_color_background;
  @if $bottomline_color_background_opacity < 100 {
    background-color: rgba($bottomline_color_background, ( $bottomline_color_background_opacity / 100 ) );
  }
  border-top: 1px solid mix($bottomline_color_background, $bottomline_color_foreground, 90%);
  color: $bottomline_color_foreground;
  @extend .small;
  padding: 1em;
  text-align: center;
}


/**
 * Error 404 page
 */
body.error404 {
  #main {
    box-shadow: 2px 2px 28px -8px rgba(0, 0, 0, .9);
    margin: 2em auto;
    max-width: $breakpoint_tablet;
    min-width: $breakpoint_mobile;
    width: 90%;
    padding: 2em;
    .title {
      @extend .base-title;
    }
    .content {
      border-bottom: 1px solid mix($main_color_background, $main_color_foreground, 90%);
    }
    .site-info {
      @extend .base-title;
      text-align: right;
    }
  }
}


/**
 * Boxed layout
 */
body.boxed {
  @media (min-width: $breakpoint_tablet) {
    .site-topline-wrapper,
    .site-header-wrapper,
    .site-container-wrapper,
    .site-footer-wrapper,
    .site-bottomline-wrapper {
      @extend .wrapper;
    }
    .site-topline-wrapper .wrapper {
      padding: 0 .4em;
    }
    .site-container,
    .site-footer {
      padding: 0 1em;
    }
    .site-header-wrapper {
      padding: 0;
      .site-header {
        width: auto;
        margin: 0 1em;
      }
    }
    .site-container-wrapper {
      body.effects & {
        box-shadow: 0 0 38px -11px rgba(0, 0, 0, .5);
      }
    }
  }
}


/**
 * Frontpage
 */
.frontpage-under {
  @media (min-width: $breakpoint_tablet) {
    display: table;
    width: 100%;
    table-layout: fixed;
    .frontpage-under-primary {
      width: 60%;
      display: table-cell;
      vertical-align: top;
    }
    .frontpage-under-secondary {
      display: table-cell;
      vertical-align: top;
    }
  }
}
